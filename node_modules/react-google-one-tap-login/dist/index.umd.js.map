{"version":3,"file":"index.umd.js","sources":["../src/useScript.ts","../src/useGoogleOneTapLogin.ts","../src/index.ts"],"sourcesContent":["// https://usehooks.com/useScript/\nimport { useState, useEffect } from 'react';\n\nexport default function useScript(src: string): string {\n  // Keep track of script status (\"idle\", \"loading\", \"ready\", \"error\")\n  const [status, setStatus] = useState<string>(src ? 'loading' : 'idle');\n\n  useEffect(\n    () => {\n      // Allow falsy src value if waiting on other data needed for\n      // constructing the script URL passed to this hook.\n      if (!src) {\n        setStatus('idle');\n        return;\n      }\n\n      // Fetch existing script element by src\n      // It may have been added by another intance of this hook\n      let script: HTMLScriptElement | null = document.querySelector(\n        `script[src=\"${src}\"]`,\n      );\n\n      if (!script) {\n        // Create script\n        script = document.createElement('script');\n        script.src = src;\n        script.async = true;\n        script.setAttribute('data-status', 'loading');\n        // Add script to document body\n        document.body.appendChild(script);\n\n        // Store status in attribute on script\n        // This can be read by other instances of this hook\n        const setAttributeFromEvent = (event: Event) => {\n          !!script &&\n            script.setAttribute(\n              'data-status',\n              event.type === 'load' ? 'ready' : 'error',\n            );\n        };\n\n        script.addEventListener('load', setAttributeFromEvent);\n        script.addEventListener('error', setAttributeFromEvent);\n      } else {\n        // Grab existing script status from attribute and set to state.\n        setStatus(script.getAttribute('data-status') || 'idle');\n      }\n\n      // Script event handler to update status in state\n      // Note: Even if the script already exists we still need to add\n      // event handlers to update the state for *this* hook instance.\n      const setStateFromEvent = (event: Event) => {\n        setStatus(event.type === 'load' ? 'ready' : 'error');\n      };\n\n      // Add event listeners\n      script.addEventListener('load', setStateFromEvent);\n      script.addEventListener('error', setStateFromEvent);\n\n      // Remove event listeners on cleanup\n      return () => {\n        if (script) {\n          script.removeEventListener('load', setStateFromEvent);\n          script.removeEventListener('error', setStateFromEvent);\n        }\n      };\n    },\n    [src], // Only re-run effect if script src changes\n  );\n\n  return status;\n}\n","import { useEffect } from 'react';\nimport {\n  IUseGoogleOneTapLogin,\n  IGoogleCallbackResponse,\n  IGoogleEndPointResponse,\n} from './types';\nimport useScript from './useScript';\n\nconst scriptFlag: string = '__googleOneTapScript__';\nconst googleClientScriptURL: string = 'https://accounts.google.com/gsi/client';\nconst oauthEndpointURL: string =\n  'https://oauth2.googleapis.com/tokeninfo?id_token=';\n\nfunction callback({\n  data,\n  onError,\n  onSuccess,\n}: {\n  data: IGoogleCallbackResponse;\n  onError?: IUseGoogleOneTapLogin['onError'];\n  onSuccess?: IUseGoogleOneTapLogin['onSuccess'];\n}) {\n  if (data?.credential) {\n    fetch(`${oauthEndpointURL}${data.credential}`)\n      .then((resp) => {\n        if (resp?.status === 200 && resp?.json) {\n          return resp.json();\n        } else {\n          if (onError) {\n            onError();\n          }\n          throw new Error('Something went wrong');\n        }\n      })\n      .then((resp: IGoogleEndPointResponse) => {\n        if (onSuccess) {\n          onSuccess(resp);\n        }\n      })\n      .catch((error) => {\n        if (onError) {\n          onError(error);\n        }\n        throw error;\n      });\n  }\n}\n\nexport function useGoogleOneTapLogin({\n  onError,\n  disabled,\n  onSuccess,\n  googleAccountConfigs,\n  disableCancelOnUnmount = false,\n}: IUseGoogleOneTapLogin) {\n  const script = useScript(googleClientScriptURL);\n  // Use the user's custom callback if they specified one; otherwise use the default one defined above:\n  const callbackToUse = googleAccountConfigs.callback\n    ? googleAccountConfigs.callback\n    : (data: IGoogleCallbackResponse) => callback({ data, onError, onSuccess });\n\n  useEffect(() => {\n    if (!window?.[scriptFlag] && window.google && script === 'ready') {\n      window.google.accounts.id.initialize({\n        ...googleAccountConfigs,\n        callback: callbackToUse,\n      });\n      window[scriptFlag] = true;\n    }\n    if (window?.[scriptFlag] && script === 'ready' && !disabled) {\n      window.google.accounts.id.prompt();\n\n      return () => {\n        if (!disableCancelOnUnmount) {\n          window.google.accounts.id.cancel();\n        }\n      };\n    }\n  }, [script, window?.[scriptFlag], disabled]);\n\n  return null;\n}\n","import { memo } from 'react';\nimport { IGoogleOneTapLogin } from './types';\nimport { useGoogleOneTapLogin } from './useGoogleOneTapLogin';\n\nfunction GoogleOneTapLogin({ children = null, ...props }: IGoogleOneTapLogin) {\n  useGoogleOneTapLogin(props);\n  return children;\n}\n\nexport default memo(GoogleOneTapLogin);\n\nexport { useGoogleOneTapLogin };\n"],"names":["useState","useEffect","memo"],"mappings":"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"}